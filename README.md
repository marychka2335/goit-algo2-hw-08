# –î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ —Ç–µ–º–∏ ¬´–ê–ª–≥–æ—Ä–∏—Ç–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é –ø–æ—Ç–æ–∫—É —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ¬ª

–£—è–≤—ñ—Ç—å, —â–æ –≤ —á–∞—Ç-—Å–∏—Å—Ç–µ–º—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Å–ø–∞–º—É. –í–∞–º –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –¥–≤–æ–º–∞ —Å–ø–æ—Å–æ–±–∞–º–∏:

–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∞–ª–≥–æ—Ä–∏—Ç–º—É Sliding Window –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤, —â–æ –± –¥–æ–∑–≤–æ–ª—è–ª–æ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –∑–∞–¥–∞–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –≤—ñ–∫–Ω—ñ –π –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —è–∫—â–æ –ª—ñ–º—ñ—Ç –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ.
–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∞–ª–≥–æ—Ä–∏—Ç–º—É Throttling –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏, —â–æ –± –∑–∞–±–µ–∑–ø–µ—á—É–≤–∞–ª–æ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –π –æ–±–º–µ–∂—É–≤–∞–ª–æ —á–∞—Å—Ç–æ—Ç—É –≤—ñ–¥–ø—Ä–∞–≤–∫–∏, —è–∫—â–æ —Ü—å–æ–≥–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –Ω–µ –¥–æ—Ç—Ä–∏–º–∞–Ω–æ.

–ó–∞–≤–¥–∞–Ω–Ω—è 1. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Rate Limiter –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∞–ª–≥–æ—Ä–∏—Ç–º—É Sliding Window –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —á–∞—Ç—ñ



–£ —á–∞—Ç-—Å–∏—Å—Ç–µ–º—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Å–ø–∞–º—É. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º Sliding Window –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –∑–∞–¥–∞–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –≤—ñ–∫–Ω—ñ –π –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —è–∫—â–æ –ª—ñ–º—ñ—Ç –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ.



–¢–µ—Ö–Ω—ñ—á–Ω—ñ —É–º–æ–≤–∏

1. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º Sliding Window –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤.

2. –ë–∞–∑–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å–∏—Å—Ç–µ–º–∏: —Ä–æ–∑–º—ñ—Ä –≤—ñ–∫–Ω–∞ (window_size) ‚Äî 10 —Å–µ–∫—É–Ω–¥ —ñ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –≤—ñ–∫–Ω—ñ (max_requests) ‚Äî 1.

3. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –∫–ª–∞—Å SlidingWindowRateLimiter.

4. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –º–µ—Ç–æ–¥–∏ –∫–ª–∞—Å—É:

_cleanup_window ‚Äî –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –∑ –≤—ñ–∫–Ω–∞ —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Å–æ–≤–æ–≥–æ –≤—ñ–∫–Ω–∞;
can_send_message ‚Äî –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –ø–æ—Ç–æ—á–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –≤—ñ–∫–Ω—ñ;
record_message ‚Äî –¥–ª—è –∑–∞–ø–∏—Å—É –Ω–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –π –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞;
time_until_next_allowed ‚Äî –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —á–∞—Å—É –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ‚Äî collections.deque.



–ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è

 üìå–ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è –¥–æ–º–∞—à–Ω—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è —î –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ—é —É–º–æ–≤–æ—é —Ä–æ–∑–≥–ª—è–¥—É –¥–æ–º–∞—à–Ω—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –º–µ–Ω—Ç–æ—Ä–æ–º. –Ø–∫—â–æ —è–∫–∏–π—Å—å —ñ–∑ –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–æ, –º–µ–Ω—Ç–æ—Ä –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –î–ó –Ω–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –±–µ–∑ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è. –Ø–∫—â–æ –≤–∞–º ¬´—Ç—ñ–ª—å–∫–∏ —É—Ç–æ—á–Ω–∏—Ç–∏¬ªüòâ –∞–±–æ –≤–∏ –∑–∞—Å—Ç–æ–ø–æ—Ä–∏–ª–∏—Å—è –Ω–∞ —è–∫–æ–º—É—Å—å –∑ –µ—Ç–∞–ø—ñ–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Äî –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –¥–æ –º–µ–Ω—Ç–æ—Ä–∞ —É Slack).
1. –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ä–∞–Ω—ñ—à–µ –Ω—ñ–∂ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥–æ–º can_send_message –∑–Ω–∞—á–µ–Ω–Ω—è False.

2. –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è True.

3. –ü—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –≤—Å—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ –≤—ñ–∫–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑–∞–ø–∏—Å –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö.

4. –ú–µ—Ç–æ–¥ time_until_next_allowed –ø–æ–≤–µ—Ä—Ç–∞—î —á–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

5. –¢–µ—Å—Ç–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–≥—ñ–¥–Ω–æ –∑ –ø—Ä–∏–∫–ª–∞–¥–æ–º –ø—Ä–æ–≥–Ω–∞–Ω–∞ –π –ø—Ä–∞—Ü—é—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –æ—á—ñ–∫—É–≤–∞–Ω—å.



–®–∞–±–ª–æ–Ω –∑–∞–≤–¥–∞–Ω–Ω—è

import random
from typing import Dict
import time
from collections import deque

class SlidingWindowRateLimiter:
    def __init__(self, window_size: int = 10, max_requests: int = 1):
				pass
    def _cleanup_window(self, user_id: str, current_time: float) -> None:
        pass

    def can_send_message(self, user_id: str) -> bool:
        pass

    def record_message(self, user_id: str) -> bool:
        pass

    def time_until_next_allowed(self, user_id: str) -> float:
        pass

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏
def test_rate_limiter():
    # –°—Ç–≤–æ—Ä—é—î–º–æ rate limiter: –≤—ñ–∫–Ω–æ 10 —Å–µ–∫—É–Ω–¥, 1 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    limiter = SlidingWindowRateLimiter(window_size=10, max_requests=1)

    # –°–∏–º—É–ª—é—î–º–æ –ø–æ—Ç—ñ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ ID –≤—ñ–¥ 1 –¥–æ 20)
    print("\\n=== –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ—Ç–æ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ===")
    for message_id in range(1, 11):
        # –°–∏–º—É–ª—é—î–º–æ —Ä—ñ–∑–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (ID –≤—ñ–¥ 1 –¥–æ 5)
        user_id = message_id % 5 + 1

        result = limiter.record_message(str(user_id))
        wait_time = limiter.time_until_next_allowed(str(user_id))

        print(f"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è {message_id:2d} | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_id} | "
              f"{'‚úì' if result else f'√ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")

        # –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –¥–ª—è —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ
        # –í–∏–ø–∞–¥–∫–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –≤—ñ–¥ 0.1 –¥–æ 1 —Å–µ–∫—É–Ω–¥–∏
        time.sleep(random.uniform(0.1, 1.0))

    # –ß–µ–∫–∞—î–º–æ, –ø–æ–∫–∏ –≤—ñ–∫–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å—Å—è
    print("\\n–û—á—ñ–∫—É—î–º–æ 4 —Å–µ–∫—É–Ω–¥–∏...")
    time.sleep(4)

    print("\\n=== –ù–æ–≤–∞ —Å–µ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è ===")
    for message_id in range(11, 21):
        user_id = message_id % 5 + 1
        result = limiter.record_message(str(user_id))
        wait_time = limiter.time_until_next_allowed(str(user_id))
        print(f"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è {message_id:2d} | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_id} | "
              f"{'‚úì' if result else f'√ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")
        # –í–∏–ø–∞–¥–∫–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –≤—ñ–¥ 0.1 –¥–æ 1 —Å–µ–∫—É–Ω–¥–∏
        time.sleep(random.uniform(0.1, 1.0))

if __name__ == "__main__":
    test_rate_limiter()



–û—á—ñ–∫—É–≤–∞–Ω–µ –≤–∏–≤–µ–¥–µ–Ω–Ω—è

=== –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ—Ç–æ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ===
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  1 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  2 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  3 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  4 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  5 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  6 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.0—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  7 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 6.5—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  8 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.0—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  9 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 6.8—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 10 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.4—Å)

–û—á—ñ–∫—É—î–º–æ 4 —Å–µ–∫—É–Ω–¥–∏...

=== –ù–æ–≤–∞ —Å–µ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è ===
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 11 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 1.0—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 12 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.7—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 13 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.4—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 14 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.0—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 15 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 16 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 17 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 18 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 19 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 20 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.0—Å)





–ó–∞–≤–¥–∞–Ω–Ω—è 2. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Rate Limiter –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∞–ª–≥–æ—Ä–∏—Ç–º—É Throttling –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —á–∞—Ç—ñ



–£ —á–∞—Ç-—Å–∏—Å—Ç–µ–º—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Å–ø–∞–º—É. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º Throttling –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏, —è–∫–∏–π –∑–∞–±–µ–∑–ø–µ—á—É—î —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –π –æ–±–º–µ–∂—É—î —á–∞—Å—Ç–æ—Ç—É –≤—ñ–¥–ø—Ä–∞–≤–∫–∏, —è–∫—â–æ —Ü—å–æ–≥–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –Ω–µ –¥–æ—Ç—Ä–∏–º–∞–Ω–æ.



–¢–µ—Ö–Ω—ñ—á–Ω—ñ —É–º–æ–≤–∏

1. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º Throttling –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤.

2. –ë–∞–∑–æ–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–∏—Å—Ç–µ–º–∏: –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ (min_interval) ‚Äî 10 —Å–µ–∫—É–Ω–¥.

3. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –∫–ª–∞—Å ThrottlingRateLimiter.

4. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –º–µ—Ç–æ–¥–∏ –∫–ª–∞—Å—É:

can_send_message ‚Äî –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —á–∞—Å—É –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è;
record_message ‚Äî –¥–ª—è –∑–∞–ø–∏—Å—É –Ω–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º —á–∞—Å—É –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è;
time_until_next_allowed ‚Äî –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —á–∞—Å—É –¥–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —á–∞—Å—É –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äî Dict[str, float].



–ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è

1. –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ä–∞–Ω—ñ—à–µ –Ω—ñ–∂ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –ø—ñ—Å–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥–æ–º can_send_message –∑–Ω–∞—á–µ–Ω–Ω—è False.

2. –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è True.

3. –ú–µ—Ç–æ–¥ time_until_next_allowed –ø–æ–≤–µ—Ä—Ç–∞—î —á–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

4. –¢–µ—Å—Ç–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–≥—ñ–¥–Ω–æ –∑ –ø—Ä–∏–∫–ª–∞–¥–æ–º –ø—Ä–æ–≥–Ω–∞–Ω–∞ –π –ø—Ä–∞—Ü—é—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –æ—á—ñ–∫—É–≤–∞–Ω—å.



–®–∞–±–ª–æ–Ω –∑–∞–≤–¥–∞–Ω–Ω—è

import time
from typing import Dict
import random

class ThrottlingRateLimiter:
    def __init__(self, min_interval: float = 10.0):
        pass

    def can_send_message(self, user_id: str) -> bool:
        pass

    def record_message(self, user_id: str) -> bool:
        pass

    def time_until_next_allowed(self, user_id: str) -> float:
        pass

def test_throttling_limiter():
    limiter = ThrottlingRateLimiter(min_interval=10.0)

    print("\\n=== –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ—Ç–æ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (Throttling) ===")
    for message_id in range(1, 11):
        user_id = message_id % 5 + 1

        result = limiter.record_message(str(user_id))
        wait_time = limiter.time_until_next_allowed(str(user_id))

        print(f"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è {message_id:2d} | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_id} | "
              f"{'‚úì' if result else f'√ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")

        # –í–∏–ø–∞–¥–∫–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏
        time.sleep(random.uniform(0.1, 1.0))

    print("\\n–û—á—ñ–∫—É—î–º–æ 10 —Å–µ–∫—É–Ω–¥...")
    time.sleep(10)

    print("\\n=== –ù–æ–≤–∞ —Å–µ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è ===")
    for message_id in range(11, 21):
        user_id = message_id % 5 + 1
        result = limiter.record_message(str(user_id))
        wait_time = limiter.time_until_next_allowed(str(user_id))
        print(f"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è {message_id:2d} | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_id} | "
              f"{'‚úì' if result else f'√ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")
        time.sleep(random.uniform(0.1, 1.0))

if __name__ == "__main__":
    test_throttling_limiter()



–û—á—ñ–∫—É–≤–∞–Ω–µ –≤–∏–≤–µ–¥–µ–Ω–Ω—è

=== –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ—Ç–æ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (Throttling) ===
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  1 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  2 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  3 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  4 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  5 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  6 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.4—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  7 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.6—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  8 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.6—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  9 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.6—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 10 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.4—Å)

–û—á—ñ–∫—É—î–º–æ 4 —Å–µ–∫—É–Ω–¥–∏...

=== –ù–æ–≤–∞ —Å–µ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è ===
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 11 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.7—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 12 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.6—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 13 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.5—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 14 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 15 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 16 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 17 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 18 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | ‚úì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 19 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.9—Å)
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 20 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.7—Å)
